<main class="container">
  <h1>Liegestütze Statistik</h1>

  <mat-card class="controls">
    <mat-form-field appearance="outline">
      <mat-label>Von</mat-label>
      <input matInput type="date" [(ngModel)]="from" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Bis</mat-label>
      <input matInput type="date" [(ngModel)]="to" />
    </mat-form-field>

    <button mat-flat-button color="primary" (click)="load()">Aktualisieren</button>
    <button mat-stroked-button (click)="loadAll()">Alles</button>
  </mat-card>

  <section class="kpis">
    <mat-card><span>Gesamt</span><b>{{ total }}</b></mat-card>
    <mat-card><span>Tage</span><b>{{ days }}</b></mat-card>
    <mat-card><span>Einträge</span><b>{{ entries }}</b></mat-card>
    <mat-card><span>Ø / Tag</span><b>{{ avg }}</b></mat-card>
  </section>

  <mat-card class="chart">
    <h2>{{ granularity === 'hourly' ? 'Verlauf (Stundenwerte)' : 'Verlauf (Tageswerte)' }}</h2>
    <canvas #chartCanvas width="1100" height="320"></canvas>
    <p class="legend">Blau: Intervallwert · Orange: Tages-Integral (kumuliert pro Tag)</p>
  </mat-card>

  <mat-card>
    <h2>{{ granularity === 'hourly' ? 'Stundenwerte' : 'Tageswerte' }}</h2>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>{{ granularity === 'hourly' ? 'Zeit' : 'Datum' }}</th>
            <th>Liegestütze</th>
          </tr>
        </thead>
        <tbody>
          @for (row of rows; track row.bucket) {
            <tr>
              <td>{{ fmtBucket(row.bucket) }}</td>
              <td>{{ row.total }}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </mat-card>
</main>
