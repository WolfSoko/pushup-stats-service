<main class="container">
  <header class="page-header">
    <img
      class="brand-logo"
      src="assets/pushup-logo.svg"
      alt="Pushup Tracker Logo"
      i18n-alt="@@brandLogoAlt"
    />
    <div>
      <p class="eyebrow" i18n="@@eyebrowTitle">Pushup Stats</p>
      <h1 i18n="@@dashboardTitle">Liegestütze Statistik</h1>
      <p class="subtitle" i18n="@@dashboardSubtitle">
        Behalte Trainingsvolumen und Verlauf im Blick – klar, schnell und mobil
        optimiert.
      </p>
      <p
        class="live-state"
        [class.offline]="!liveConnected()"
        i18n="@@liveStateLabel"
      >
        Live: {{ liveConnected() ? 'verbunden' : 'getrennt' }}
      </p>
    </div>
  </header>

  <section
    class="today-focus"
    aria-label="Tagesfokus"
    i18n-aria-label="@@todayFocusAria"
  >
    <mat-card>
      <mat-card-header>
        <mat-card-title
          >{{ periodTitle() }} <span i18n>Gesamt</span></mat-card-title
        >
      </mat-card-header>
      <mat-card-content>
        <p class="focus-number">{{ periodTotal() }}</p>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title i18n="@@goalProgressTitle"
          >Zielfortschritt</mat-card-title
        >
      </mat-card-header>
      <mat-card-content>
        <p>{{ periodTotal() }} / {{ periodGoal() }}</p>
        <mat-progress-bar
          mode="determinate"
          [value]="goalProgressPercent()"
        ></mat-progress-bar>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title i18n="@@lastEntryTitle">Letzter Eintrag</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (lastEntry(); as latest) {
          <p i18n="@@latEntryReps">
            {{ latest.reps }} Reps · {{ latest.type || 'Standard' }}
          </p>
          <small>{{ latest.timestamp | date: 'short' }}</small>
        } @else {
          <p i18n="@@noEntryInPeriod">Noch kein Eintrag für diesen Zeitraum.</p>
        }
      </mat-card-content>
    </mat-card>
  </section>

  <section
    class="mini-badges"
    aria-label="All-Time Kurzübersicht"
    i18n-aria-label="@@allTimeSummaryAria"
  >
    <span class="badge"
      ><small i18n="@@allTimeTotal">All-Time Gesamt</small
      ><b>{{ allTimeTotal() }}</b></span
    >
    <span class="badge"
      ><small i18n="@@allTimeDays">All-Time Tage</small
      ><b>{{ allTimeDays() }}</b></span
    >
    <span class="badge"
      ><small i18n="@@allTimeEntries">All-Time Einträge</small
      ><b>{{ allTimeEntries() }}</b></span
    >
    <span class="badge"
      ><small i18n="@@allTimeAvg">All-Time Ø/Tag</small
      ><b>{{ allTimeAvg() }}</b></span
    >
  </section>

  <mat-card class="quick-actions">
    <mat-card-header>
      <mat-card-title i18n="@@quickActionsTitle"
        >Schnellaktionen</mat-card-title
      >
      <mat-card-subtitle i18n="@@quickActionsSubtitle"
        >Schnell eintragen ohne Dialog</mat-card-subtitle
      >
    </mat-card-header>
    <mat-card-content>
      <button
        type="button"
        mat-flat-button
        class="quick-btn quick-btn--ten"
        (click)="addQuickEntry(10)"
        i18n="@@quickAdd10"
      >
        <mat-icon>bolt</mat-icon>
        +10 Reps
      </button>
      <button
        type="button"
        mat-flat-button
        class="quick-btn quick-btn--twenty"
        (click)="addQuickEntry(20)"
        i18n="@@quickAdd20"
      >
        <mat-icon>flash_on</mat-icon>
        +20 Reps
      </button>
      <button
        type="button"
        mat-flat-button
        class="quick-btn quick-btn--thirty"
        (click)="addQuickEntry(30)"
        i18n="@@quickAdd30"
      >
        <mat-icon>whatshot</mat-icon>
        +30 Reps
      </button>
    </mat-card-content>
  </mat-card>

  <section class="panel">
    <app-filter-bar
      [from]="from()"
      [to]="to()"
      (fromChange)="from.set($event)"
      (toChange)="to.set($event)"
      (modeChange)="rangeMode.set($event)"
    />
  </section>

  @if (errorMessage()) {
    <section class="status-banner error" role="alert" aria-live="polite">
      {{ errorMessage() }}
    </section>
  }

  @if (loading()) {
    <section
      class="status-banner loading"
      aria-live="polite"
      i18n="@@loadingStats"
    >
      Lade Statistikdaten…
    </section>
  }

  <section class="mid-grid">
    <app-stats-chart
      [series]="rows()"
      [granularity]="granularity()"
      [rangeMode]="rangeMode()"
    />
  </section>

  <section class="latest-entries">
    <h2 i18n="@@entriesInSelectedRange">Einträge im gewählten Zeitraum</h2>
    <app-stats-table
      [entries]="entryRows()"
      [busyAction]="busyAction()"
      [busyId]="busyId()"
      (create)="onCreateEntry($event)"
      (update)="onUpdateEntry($event)"
      (remove)="onDeleteEntry($event)"
    />
  </section>
</main>
