<main class="container">
  <header class="page-header">
    <img class="brand-logo" src="assets/pushup-logo.svg" alt="Pushup Tracker Logo" />
    <div>
      <p class="eyebrow">Pushup Stats</p>
      <h1>Liegestütze Statistik</h1>
      <p class="subtitle">Behalte Trainingsvolumen und Verlauf im Blick – klar, schnell und mobil optimiert.</p>
      <p class="live-state" [class.offline]="!liveConnected()">Live: {{ liveConnected() ? 'verbunden' : 'getrennt' }}</p>
    </div>
  </header>

  <section class="today-focus" aria-label="Tagesfokus">
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{ periodTitle() }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p class="focus-number">{{ periodTotal() }}</p>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title>Zielfortschritt</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>{{ periodTotal() }} / {{ periodGoal() }}</p>
        <mat-progress-bar mode="determinate" [value]="goalProgressPercent()"></mat-progress-bar>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title>Letzter Eintrag</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (lastEntry(); as latest) {
          <p>{{ latest.reps }} Reps · {{ latest.type || 'Standard' }}</p>
          <small>{{ latest.timestamp | date: 'dd.MM.yyyy, HH:mm' }}</small>
        } @else {
          <p>Noch kein Eintrag für diesen Zeitraum.</p>
        }
      </mat-card-content>
    </mat-card>
  </section>

  <section class="mini-badges" aria-label="All-Time Kurzübersicht">
    <span class="badge"><small>All-Time Gesamt</small><b>{{ allTimeTotal() }}</b></span>
    <span class="badge"><small>All-Time Tage</small><b>{{ allTimeDays() }}</b></span>
    <span class="badge"><small>All-Time Einträge</small><b>{{ allTimeEntries() }}</b></span>
    <span class="badge"><small>All-Time Ø/Tag</small><b>{{ allTimeAvg() }}</b></span>
  </section>

  <mat-card class="quick-actions">
    <mat-card-header>
      <mat-card-title>Schnellaktionen</mat-card-title>
      <mat-card-subtitle>Schnell eintragen ohne Dialog</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <button type="button" mat-flat-button class="quick-btn quick-btn--ten" (click)="addQuickEntry(10)">
        <mat-icon>bolt</mat-icon>
        +10 Reps
      </button>
      <button type="button" mat-flat-button class="quick-btn quick-btn--twenty" (click)="addQuickEntry(20)">
        <mat-icon>flash_on</mat-icon>
        +20 Reps
      </button>
      <button type="button" mat-flat-button class="quick-btn quick-btn--thirty" (click)="addQuickEntry(30)">
        <mat-icon>whatshot</mat-icon>
        +30 Reps
      </button>
    </mat-card-content>
  </mat-card>

  <section class="panel">
    <app-filter-bar
      [from]="from()"
      [to]="to()"
      (fromChange)="from.set($event)"
      (toChange)="to.set($event)"
      (modeChange)="rangeMode.set($event)"
    />
  </section>

  @if (errorMessage()) {
    <section class="status-banner error" role="alert" aria-live="polite">
      {{ errorMessage() }}
    </section>
  }

  @if (loading()) {
    <section class="status-banner loading" aria-live="polite">Lade Statistikdaten…</section>
  }

  <section class="mid-grid">
    <app-stats-chart [series]="rows()" [granularity]="granularity()" [rangeMode]="rangeMode()" />
  </section>

  <section class="latest-entries">
    <h2>Einträge im gewählten Zeitraum</h2>
    <app-stats-table
      [entries]="entryRows()"
      [busyAction]="busyAction()"
      [busyId]="busyId()"
      (create)="onCreateEntry($event)"
      (update)="onUpdateEntry($event)"
      (remove)="onDeleteEntry($event)"
    />
  </section>
</main>
